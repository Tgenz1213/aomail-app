<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sign Up</title>
    <script>
        function signup() {
            const login = document.getElementById('login').value;
            const password = document.getElementById('password').value;
            const confirm_password = document.getElementById('confirm_password').value;

            if (login && password && confirm_password) {
                // Here you can perform additional validation
                // Ensure passwords match, length, etc.

                // If validation passes, prepare the data to send

                // Make a POST request to the backend
                fetch('/MailAssistant/signup/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ login: login, password: password })
                })
                .then(response => {
                    // Handle the response from the server
                    if (response.ok) {
                        return response.json(); // Parse the JSON response
                    } else {
                        throw new Error('Registration failed. Please try again.');
                    }
                })
                .then(data => {
                    // Assuming the response contains 'access_token' and 'user_id'
                    sessionStorage.setItem("access_token", data.access_token);
                    sessionStorage.setItem("user_id", data.user_id);
                    console.log("Successful registration");

                    // Make another fetch request with headers
                    fetch('/MailAssistant/google/auth_url/', {
                        headers: {
                            'access_token': sessionStorage.getItem("access_token"),
                            'user_id': sessionStorage.getItem("user_id")
                        }
                    })
                    .then(response => {
                        // Handle the response from the second fetch
                        // ...
                    })
                    .catch(error => {
                        // Handle errors from the second fetch
                        console.error('Error:', error);
                    });
                })
                .catch(error => {
                    // Handle network or registration errors
                    console.error('Error:', error);
                });
            } else {
                console.log('Please fill in all fields.');
            }
        }
    </script>
</head>
<body>
    <div>
        <label for="login">Login:</label>
        <input type="text" id="login" name="login" required>
    </div>
    <div>
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required>
    </div>
    <div>
        <label for="confirm_password">Confirm Password:</label>
        <input type="password" id="confirm_password" name="confirm_password" required>
    </div>
    <div>
        <button onclick="signup()">Link Gmail Account & Sign Up</button>
    </div>
</body>
</html>
